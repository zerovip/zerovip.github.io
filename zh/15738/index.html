<!DOCTYPE html>
<html class="theme-container" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=divice-width,initial-scale=1" name="viewport"/>
<meta content="Hugo 0.88.1" name="generator"/>
<title>
Hugo 如何让图片在暗色主题下反色 - 自写主题
| 赤赤的象牙塔
</title>
<link href="../../css/base.min.7a1b5c1c1d7e43ac09f0cd1df239e034cbdf5fa7439794fb7b5fe1225963173c.css" rel="stylesheet" type="text/css"/>
<link href="../../css/small.min.f9c67371e05b88a9468d51903bbe4d52be301b7e498d3f1dc7fbff95f35f2929.css" media="screen and (max-width: 1200px)" rel="stylesheet" type="text/css"/>
<link href="../../css/normal.min.7fe55f32650b9c713cce8ccc9a63d23eecaff2b247b70a69bf3650b249319609.css" media="screen and (min-width: 1201px)" rel="stylesheet" type="text/css"/>
<link href="../../css/syntax.min.ed5b37c3a50997d5ccd8b81bf0d00a7ac1f92c82985623c2dbf0cb422596726a.css" rel="stylesheet" type="text/css"/>
<script src="../../js/ctheme.min.2b9744ea6df95f636aae562954ce13add68a9c7b99203c9ac1aa4671b6238958.js"></script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6CF2JBMYH3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-6CF2JBMYH3',{anonymize_ip:!1})}</script>
<script async="" data-goatcounter="https://zerovip.goatcounter.com/count" src="//gc.zgo.at/count.js"></script>
</head>
<body>
<nav class="bar_for_phone">
<div class="bar_left_button">
<div class="left_button_for_bar" onclick="ChangeClassLeft()">
<div class="bar1"></div>
<div class="bar2"></div>
<div class="bar3"></div>
</div>
</div>
<div class="bar_title">
<a href="../../zh/">赤赤的象牙塔</a>
</div>
<div class="bar_right_button">
<button class="toc_title_for_bar" onclick="ChangeClassTOC()">目录</button>
</div>
</nav>
<div class="body_for_pc">
<aside class="left" id="left">
<div class="left_non-footer">
<div class="left_non-footer_option">
<div aria-checked="true" class="left_non-footer_option_theme-switch" role="checkbox">
<label class="switch">
<input class="theme-switcher" onchange="themeSwitch()" type="checkbox"/>
<span class="slider round"></span>
</label>
</div>
<ul class="left_non-footer_option_language" role="listbox">
<li aria-selected="true" class="left_non-footer_option_active" role="option">
简体中文 ⦿
</li>
<li aria-selected="false" class="left_non-footer_option_non-active" role="option">
<a href="../../en/15738/">
English ○
</a>
</li>
<li class="left_non-footer_option_non-active" role="option">
Français ⨂
</li>
</ul>
<div class="left_non-footer_option_rss">
<div class="left_non-footer_option_non-active">
RSS 订阅 ⊠
</div>
</div>
</div>
<header class="left_non-footer_head">
<div class="left_non-footer_head_title">
<a href="../../zh/">
赤赤的象牙塔
</a>
</div>
<div class="left_non-footer_head_subtitle">(●’◡’●)ﾉ</div>
</header>
<nav class="left_non-footer_main">
<div class="h1">
<a href="../../zh/math/">数学</a>
</div>
<div class="h2">
<a href="../../zh/math/notes/">数学笔记 </a>
</div>
<div class="h2">
<a href="../../zh/math/stories/">数学科普 </a>
</div>
<div class="h1 active">
<a href="../../zh/non-math/">非数学</a>
</div>
<div class="h2">
<a href="../../zh/non-math/journal/">日志 </a>
</div>
<div class="h2">
<a href="../../zh/non-math/literature/">写作 </a>
</div>
<div class="h2 active">
<a href="../../zh/non-math/memos/">备忘 </a>
</div>
<div class="h1">
<a href="../../zh/record/">记录</a>
</div>
<div class="h2">
<a href="../../zh/record/book/">读过的书 </a>
</div>
<div class="h2">
<a href="../../zh/record/film/">看过的电影 </a>
</div>
<div class="h1">
<a href="../../zh/about/">关于</a>
</div>
<div class="h2">
<a href="../../zh/about/me/">关于我 </a>
</div>
<div class="h2">
<a href="../../zh/about/site/">关于本站 </a>
</div>
</nav>
</div>
<footer class="left_footer">
<div class="copyright">©2019-2021 版权所有.</div>
</footer>
</aside>
<div class="right" onclick="HideBothSide()">
<header class="right_head">
<div class="right_head_title">
Hugo 如何让图片在暗色主题下反色 - 自写主题
</div>
<div class="right_head_des">
2021年8月28日 - 1002 字
</div>
</header>
<div class="right_main">
<article class="right_main_article">
<p>本文探讨的是图片在亮色、暗色主题下的显示问题，里面有一些图片示例，请读者们手动调节本站的主题来测试它们的显示效果. 调节按钮在左边栏的右上角，手机等小屏幕请点击左上角的汉堡按钮呼出左边栏.</p>
<h1 id="问题">
问题
<a href="#%e9%97%ae%e9%a2%98"><small>¶</small></a>
</h1>
<p>有些图片是白底黑字，在暗色主题下刺眼：</p>
<p><figure>
<img alt="白底黑字的示例图" loading="lazy" src="lorem.jpg" style="filter:var(--c-img-filter2)"/>
<figcaption>◉ 图. 白底黑字的示例图</figcaption>
</figure>
</p>
<p>有些图片是透明背景黑字，在暗色主题下看不清：</p>
<p><figure>
<img alt="透明背景黑字的示例图" loading="lazy" src="lorem.png" style="filter:var(--c-img-filter2)"/>
<figcaption>◉ 图. 透明背景黑字的示例图</figcaption>
</figure>
</p>
<p>以上这两种情况都需要在读者选择暗色主题的时候进行反色处理.</p>
<h1 id="处理思路">
处理思路
<a href="#%e5%a4%84%e7%90%86%e6%80%9d%e8%b7%af"><small>¶</small></a>
</h1>
<p>颜色的反转使用 CSS 的滤镜（filters）技术即可，比如在如下代码中，<code>.normal</code> 是正常的颜色，<code>.inverted</code> 是反转的颜色.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma" tabindex="0"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma" tabindex="0"><code class="language-CSS" data-lang="CSS"><span class="p">.</span><span class="nc">normal</span> <span class="p">{</span>
	<span class="k">filter</span><span class="p">:</span> <span class="nb">invert</span><span class="p">(</span><span class="mi">0</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">inverted</span> <span class="p">{</span>
	<span class="k">filter</span><span class="p">:</span> <span class="nb">invert</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们可以把上面的代码套进 CSS 变量中，和两套主题的变量放在一起. 然后在 Hugo 的模板中更改处理图片用的 <a href="https://gohugo.io/getting-started/configuration-markup/#markdown-render-hooks" rel="noreferrer noopener" target="_blank">render hooks<b><sub>⧉</sub></b></a>，给图片加上适当的样式即可.</p>
<p>其中暗色主题的切换参考的是<a href="https://dev.to/lampewebdev/css-quickies-css-variables-or-how-you-create-a-white-dark-theme-easily-1i0i" rel="noreferrer noopener" target="_blank">这篇文章<b><sub>⧉</sub></b></a>，简单来说，就是在读者切换成暗色主题时给整个 <code>&lt;html&gt;</code> 容器加上一个表示暗色主题的类名（<code>.classList.add("dark")</code>），读者切换成亮色主题时将这个类名去掉（<code>.classList.remove("dark")</code>），然后在 CSS 中针对是否有那个暗色主题的类名，把不同的值定义给同一个变量，而在指定 HTML 元素的样式时直接使用那个变量即可. 详见下面的代码.</p>
<h1 id="完整代码">
完整代码
<a href="#%e5%ae%8c%e6%95%b4%e4%bb%a3%e7%a0%81"><small>¶</small></a>
</h1>
<p>首先是 HTML 示例代码，在整个 <code>&lt;html&gt;</code> 容器上定义一个类：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma" tabindex="0"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma" tabindex="0"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">class</span><span class="o">=</span><span class="s">"theme-container"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="c">&lt;!--Something…--&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>然后在 CSS 中对这个容器是否有暗色主题类名 <code>.dark</code> 分别定义变量 <code>--c-img-filter</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma" tabindex="0"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma" tabindex="0"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">theme-container</span><span class="p">{</span>
    <span class="nv">--c-img-filter</span><span class="p">:</span> <span class="nb">invert</span><span class="p">(</span><span class="mi">0</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">theme-container</span><span class="p">.</span><span class="nc">dark</span><span class="p">{</span>
    <span class="nv">--c-img-filter</span><span class="p">:</span> <span class="nb">invert</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>最后处理 Hugo 模板：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma" tabindex="0"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma" tabindex="0"><code class="language-html" data-lang="html"><span class="c">&lt;!-- layouts/_default/_markup/render-image.html --&gt;</span>

{{ $url := .Destination | safeURL }}
<span class="p">&lt;</span><span class="nt">figure</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"{{ $url }}"</span>
        <span class="err">{{</span> <span class="err">$</span><span class="na">file_name_array</span> <span class="na">:</span><span class="o">=</span> <span class="s">split</span> <span class="err">$</span><span class="na">url</span> <span class="err">"."</span> <span class="err">}}</span>
        <span class="err">{{</span> <span class="err">$</span><span class="na">file_name_len</span> <span class="na">:</span><span class="o">=</span> <span class="s">len</span> <span class="err">$</span><span class="na">file_name_array</span> <span class="err">}}</span>
        <span class="err">{{</span> <span class="na">if</span> <span class="na">eq</span> <span class="err">(</span><span class="na">index</span> <span class="err">$</span><span class="na">file_name_array</span> <span class="err">(</span><span class="na">sub</span> <span class="err">$</span><span class="na">file_name_len</span> <span class="na">2</span><span class="err">))</span> <span class="err">"</span><span class="na">i</span><span class="err">"</span> <span class="err">}}</span>
            <span class="na">style</span><span class="o">=</span><span class="s">"filter: var(--c-img-filter);"</span>
        <span class="err">{{</span> <span class="na">end</span> <span class="err">}}</span>
    <span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">figure</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>这里没有贸然对所有的图片都加上 <code>style="filter: var(--c-img-filter);"</code>，而是先对文件名进行分析，最后达到的效果是：以 <code>.i.{png|jpg|gif|jpeg|webp|…}</code> 作为文件名后缀的图片会在选择暗色主题时进行反色处理，而没有 <code>.i</code> 这个文件名修饰的图片则永远保持原样. 例如：</p>
<ul>
<li>这张图片文件名为 lorem.i.jpg，亮色模式下白底黑字、暗色模式下黑底白字</li>
</ul>
<p><figure>
<img alt="lorem.i.jpg" loading="lazy" src="lorem.i.jpg" style="filter:var(--c-img-filter)"/>
<figcaption>◉ 图. lorem.i.jpg</figcaption>
</figure>
</p>
<hr/>
<ul>
<li>这张图片文件名为 lorem.i.png，亮色模式下透明底黑字、暗色模式下透明底白字</li>
</ul>
<p><figure>
<img alt="lorem.i.png" loading="lazy" src="lorem.i.png" style="filter:var(--c-img-filter)"/>
<figcaption>◉ 图. lorem.i.png</figcaption>
</figure>
</p>
<hr/>
<ul>
<li>这张图片文件名为 cat.jpg，亮色模式与暗色模式下都是正常的颜色</li>
</ul>
<p><figure>
<img alt="cat.jpg" loading="lazy" src="cat.jpg" style="filter:var(--c-img-filter2)"/>
<figcaption>◉ 图. cat.jpg</figcaption>
</figure>
</p>
<hr/>
<p></p><p></p><p></p><p></p><p></p><p></p>
<h1>友情链接（该栏目下的其他文章）</h1>
<ol>
<li> 第 1 期：<a href="../../zh/18284/">Hugo 静态博客建站记 - 自写主题</a></li>
<li> 第 2 期：<a href="../../zh/82988/">博客记录书影音——Hugo 的 Data Templates - 自写主题</a></li>
<li> 第 3 期：<a href="../../zh/01901/">如何让静态网站的暗色主题换页不闪烁 - 自写主题</a></li>
<li> 第 4 期：Hugo 如何让图片在暗色主题下反色 - 自写主题（就是这篇！）</li>
</ol>
<p></p><p></p><p></p><p></p>
</article>
</div>
<div class="right_comments">
<script async="" crossorigin="anonymous" issue-term="pathname" repo="zerovip/bcsu" src="https://utteranc.es/client.js" theme="github-light"></script>
</div>
</div>
<aside class="toc" id="toc">
<button class="toc_title">目录</button>
<div class="toc_content">
<nav id="TableOfContents">
<ul>
<li><a href="#问题">问题</a></li>
<li><a href="#处理思路">处理思路</a></li>
<li><a href="#完整代码">完整代码</a></li>
</ul>
</nav>
</div>
</aside>
</div>
<script src="../../js/main.min.60aa2f3f5fd2bd0fbc6bfb7a3e14b1eb89f8dd2b4caa083c22b7f3cb656ea273.js"></script>
</body>
</html>