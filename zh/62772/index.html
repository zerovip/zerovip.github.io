<!DOCTYPE html>
<html><head><meta charset="utf-8"/><meta content="width=divice-width,initial-scale=1" name="viewport"/><meta content="Hugo 0.79.0" name="generator"/><title>静态博客文章加密工具测试
| 赤赤的象牙塔</title><link href="../../css/base.min.2414a4ab66a125794b99dd64a2112a6d1aafa4e75a3eef33386bfa0dbf3636c7.css" rel="stylesheet" type="text/css"/><link href="../../css/small.min.9b01719e6983c7db7efc295ed28b095908575b7fad6d8443bd02315511be4dde.css" media="screen and (max-width: 1200px)" rel="stylesheet" type="text/css"/><link href="../../css/normal.min.a476b3f1867508ae16396fa9df9d552ccded38b484c7c7c17f45683d0b2437a1.css" media="screen and (min-width: 1201px)" rel="stylesheet" type="text/css"/><link href="../../css/syntax.css" rel="stylesheet" type="text/css"/><script type="application/javascript">var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-143006759-1','auto');ga('send','pageview');}</script><script async="" src="https://www.google-analytics.com/analytics.js"></script><script async="" data-goatcounter="https://zerovip.goatcounter.com/count" src="//gc.zgo.at/count.js"></script></head><body class="theme-container"><div class="bar_for_phone"><div class="bar_left_button"><div class="left_button_for_bar" onclick="ChangeClassLeft()"><div class="bar1"></div><div class="bar2"></div><div class="bar3"></div></div></div><div class="bar_title"><a href="../../zh/">赤赤的象牙塔</a></div><div class="bar_right_button"><button class="toc_title_for_bar" onclick="ChangeClassTOC()">目录</button></div></div><div class="body_for_pc"><div class="left" id="left"><div class="left_non-footer"><div class="left_non-footer_option"><div class="theme-switch"><label class="switch"><input checked="" class="theme-switcher" type="checkbox"/>
<span class="slider round"></span></label></div><li><br/></li><li class="left_non-footer_option_active">简体中文 ⦿</li><li class="left_non-footer_option_non-active">English ⨂</li><li class="left_non-footer_option_non-active">Français ⨂</li><li><br/></li><li class="left_non-footer_option_non-active">RSS 订阅 ⨂</li><li><br/></li></div><div class="left_non-footer_head"><div class="left_non-footer_head_title"><a href="../../zh/">赤赤的象牙塔</a></div><div class="left_non-footer_head_subtitle">(●’◡’●)ﾉ</div></div><div class="left_non-footer_main"><div class="h1"><a href="../../zh/math/">数学</a></div><div class="h2"><a href="../../zh/math/notes/">数学笔记</a></div><div class="h2"><a href="../../zh/math/stories/">数学科普</a></div><div class="h1 active"><a href="../../zh/non-math/">非数学</a></div><div class="h2"><a href="../../zh/non-math/journal/">日志</a></div><div class="h2"><a href="../../zh/non-math/literature/">写作</a></div><div class="h2 active"><a href="../../zh/non-math/memos/">备忘</a></div><div class="h1"><a href="../../zh/about/">关于</a></div><div class="h2"><a href="../../zh/about/me/">关于我</a></div><div class="h2"><a href="../../zh/about/site/">关于本站</a></div></div></div><div class="left_footer"><div class="copyright">©2019-2021 版权所有.</div></div></div><div class="right"><div class="right_head"><div class="right_head_title">静态博客文章加密工具测试</div><div class="right_head_des">2019-12-23 - 656 字</div></div><div class="right_main"><div class="right_main_article"><p>一次测试.（这里是 summary 的内容.）</p><h1 id="介绍">介绍
<a href="#%e4%bb%8b%e7%bb%8d"><small>¶</small></a></h1><p><a href="https://github.com/Li4n0/hugo_encryptor" rel="noreferrer noopener" target="_blank">Hugo encryptor
<b>⧉</b></a>
是一款我偶然发现的可以给静态博客文章进行加密的小工具，配置使用很简单，可惜的是不能在本地测试.</p><p>不过它足够简单，一经测试成功可以投入使用便不再需要反复测试，因此这篇博文是专门用来测试的.</p><p>下面加密内容的密码是【PASS3word】. 这部分内容在 RSS 中没有被加密，在
<a href="../../zh/non-math/memos/index.xml">“备忘分区”的 RSS</a>
中可以找到加密的内容.</p><div class="hugo-encryptor-container"><div class="hugo-encryptor-prompt"><p>文章的部分内容被密码保护：</p></div><div class="hugo-encryptor-form"><input class="hugo-encryptor-input" placeholder="请输入密码"/>
<input class="hugo-encryptor-button" onclick="_click_handler(this)" type="button" value="点击验证"/></div><div class="hugo-encryptor-cipher-text" style="display:none">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</div></div><h2 id="未被加密的标题">未被加密的标题
<a href="#%e6%9c%aa%e8%a2%ab%e5%8a%a0%e5%af%86%e7%9a%84%e6%a0%87%e9%a2%98"><small>¶</small></a></h2><p>在解密前这里的序号是1.1，解密后这里的序号是3.4.</p><h1 id="未被加密的一级标题">未被加密的一级标题
<a href="#%e6%9c%aa%e8%a2%ab%e5%8a%a0%e5%af%86%e7%9a%84%e4%b8%80%e7%ba%a7%e6%a0%87%e9%a2%98"><small>¶</small></a></h1><p>在解密前这里的序号是2，解密后这里的序号是4.</p><h2 id="未解决的问题">未解决的问题
<a href="#%e6%9c%aa%e8%a7%a3%e5%86%b3%e7%9a%84%e9%97%ae%e9%a2%98"><small>¶</small></a></h2><ol><li>目录会出现问题. 可能是 css 标签被改了的原因，具体没有仔细看，也不着急解决这个问题.</li><li>本地测试时把加密内容直接隐藏了，以至于只能先把文章写完再进行加密操作. 有个解决思路是用 <code>{{ if not .Site.IsServer }} {{ end }}</code> 在 <code>layouts/shortcodes/hugo-encryptor.html</code> 里做一下限制，不过试了一下不太会写，留待以后愿意解决再解决吧.</li><li>那个 <code>&lt;!--more--&gt;</code> 的标签导致它上面的内容成为了 summary，而 front matter 里的 summary 不再起作用. 这倒不是什么大问题.</li></ol><p></p><p></p><p></p><p></p></div></div><div class="right_comments"><script async="" crossorigin="anonymous" issue-term="pathname" repo="zerovip/bcsu" src="https://utteranc.es/client.js" theme="github-light"></script></div></div><div class="toc" id="toc"><button class="toc_title">目录</button><div class="toc_content"><nav id="TableOfContents"><ul><li><a href="#介绍">介绍</a><ul><li><a href="#未被加密的标题">未被加密的标题</a></li></ul></li><li><a href="#未被加密的一级标题">未被加密的一级标题</a><ul><li><a href="#未解决的问题">未解决的问题</a></li></ul></li></ul></nav></div></div></div><script src="../../js/main.min.e2444643084bef89788c593b0d02a9f4d9fbb3733ebabed73967cb4e9b963947.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script><script>
const _do_decrypt = function(encrypted, password) {
  let key = CryptoJS.enc.Utf8.parse(password);
  let iv = CryptoJS.enc.Utf8.parse(password.substr(16));

  let decrypted_data = CryptoJS.AES.decrypt(encrypted, key, {
    iv: iv,
    mode: CryptoJS.mode.CBC,
    padding: CryptoJS.pad.Pkcs7
  });
  return decrypted_data.toString(CryptoJS.enc.Utf8);
};

const _click_handler = function(element) {
  let parent = element.parentNode.parentNode;
  let encrypted = parent.querySelector(
    ".hugo-encryptor-cipher-text").innerText;
  let password = parent.querySelector(
    ".hugo-encryptor-input").value;
  password = CryptoJS.MD5(password).toString();

  let index = -1;
  let elements = document.querySelectorAll(
    ".hugo-encryptor-container");
  for (index = 0; index < elements.length; ++index) {
    if (elements[index].isSameNode(parent)) {
      break;
    }
  }

  let decrypted = "";
  try {
    decrypted = _do_decrypt(encrypted, password);
  } catch (err) {
    console.error(err);
    alert("Failed to decrypt.");
    return;
  }

  if (!decrypted.includes("--- DON'T MODIFY THIS LINE ---")) {
    alert("Incorrect password.");
    return;
  }

  let storage = localStorage;

  let key = location.pathname + ".password." + index;
  storage.setItem(key, password);
  parent.innerHTML = decrypted;
}

window.onload = () => {
  let index = -1;
  let elements = document.querySelectorAll(
    ".hugo-encryptor-container");

  while (1) {
    ++index;

    let key = location.pathname + ".password." + index;
    let password = localStorage.getItem(key);

    if (!password) {
      break;

    } else {
      console.log("Found password for part " + index);

      let parent = elements[index];
      let encrypted = parent.querySelector(".hugo-encryptor-cipher-text").innerText;
      let decrypted = _do_decrypt(encrypted, password);
      elements[index].innerHTML = decrypted;
    }
  }
};</script></body></html>