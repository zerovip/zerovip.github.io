<!DOCTYPE html><html lang="zh" class="theme-container"><head><meta charset="utf-8"/><meta name="viewport" content="width=divice-width,initial-scale=1"/><meta name="generator" content="Hugo 0.99.1"/><title>静态博客文章加密工具测试
| 赤赤的象牙塔</title><link rel="stylesheet" type="text/css" href="../../css/base.min.7a1b5c1c1d7e43ac09f0cd1df239e034cbdf5fa7439794fb7b5fe1225963173c.css"/><link rel="stylesheet" media="screen and (max-width: 1200px)" type="text/css" href="../../css/small.min.f9c67371e05b88a9468d51903bbe4d52be301b7e498d3f1dc7fbff95f35f2929.css"/><link rel="stylesheet" media="screen and (min-width: 1201px)" type="text/css" href="../../css/normal.min.7fe55f32650b9c713cce8ccc9a63d23eecaff2b247b70a69bf3650b249319609.css"/><link rel="stylesheet" type="text/css" href="../../css/syntax.min.ed5b37c3a50997d5ccd8b81bf0d00a7ac1f92c82985623c2dbf0cb422596726a.css"/><script src="../../js/ctheme.min.23d42d00e692299bcf2b5832c28a8a1582346c7c45d8bc4f70280fcdbf146872.js"></script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6CF2JBMYH3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6CF2JBMYH3",{anonymize_ip:!1})}</script><script data-goatcounter="https://zerovip.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script></head><body><nav class="bar_for_phone"><div class="bar_left_button"><div class="left_button_for_bar" onclick="ChangeClassLeft()"><div class="bar1"></div><div class="bar2"></div><div class="bar3"></div></div></div><div class="bar_title"><a href="../../zh/">赤赤的象牙塔</a></div><div class="bar_right_button"><button class="toc_title_for_bar" onclick="ChangeClassTOC()">目录</button></div></nav><div class="body_for_pc"><aside class="left" id="left"><div class="left_non-footer"><div class="left_non-footer_option"><div role="checkbox" aria-checked="true" class="left_non-footer_option_theme-switch"><label class="switch"><input type="checkbox" class="theme-switcher" onchange="themeSwitch()"/>
<span class="slider round"></span></label></div><ul role="listbox" class="left_non-footer_option_language"><li role="option" aria-selected="true" class="left_non-footer_option_active">简体中文 ⦿</li><li role="option" aria-selected="false" class="left_non-footer_option_non-active"><a href="../../en/62772/">English ○</a></li><li role="option" class="left_non-footer_option_non-active">Français ⨂</li></ul><div class="left_non-footer_option_rss"><div class="left_non-footer_option_non-active">RSS 订阅 ⊠</div></div></div><header class="left_non-footer_head"><div class="left_non-footer_head_title"><a href="../../zh/">赤赤的象牙塔</a></div><div class="left_non-footer_head_subtitle">(●’◡’●)ﾉ</div></header><nav class="left_non-footer_main"><div class="h1"><a href="../../zh/math/">数学</a></div><div class="h2"><a href="../../zh/math/notes/">数学笔记</a></div><div class="h2"><a href="../../zh/math/stories/">数学科普</a></div><div class="h1 active"><a href="../../zh/non-math/">非数学</a></div><div class="h2"><a href="../../zh/non-math/journal/">日志</a></div><div class="h2"><a href="../../zh/non-math/literature/">写作</a></div><div class="h2 active"><a href="../../zh/non-math/memos/">备忘</a></div><div class="h1"><a href="../../zh/record/">记录</a></div><div class="h2"><a href="../../zh/record/book/">读过的书</a></div><div class="h2"><a href="../../zh/record/film/">看过的电影</a></div><div class="h1"><a href="../../zh/about/">关于</a></div><div class="h2"><a href="../../zh/about/me/">关于我</a></div><div class="h2"><a href="../../zh/about/site/">关于本站</a></div></nav></div><footer class="left_footer"><div class="copyright">©2019-2022 版权所有.</div></footer></aside><div class="right" onclick="HideBothSide()"><header class="right_head"><div class="right_head_title">静态博客文章加密工具测试</div><div class="right_head_des">2019年12月23日 - 1191 字</div></header><div class="right_main"><article class="right_main_article"><h1 id="介绍">介绍
<a href="#%e4%bb%8b%e7%bb%8d"><small>¶</small></a></h1><p><a href="https://github.com/Li4n0/hugo_encryptor" target="_blank" rel="noreferrer noopener">Hugo encryptor<b><sub>⧉</sub></b></a> 是一款我偶然发现的可以给静态博客文章进行加密的小工具，配置使用很简单，可惜的是不能在本地测试.</p><p>不过它足够简单，一经测试成功可以投入使用便不再需要反复测试，因此这篇博文是专门用来测试的.</p><p>下面加密内容的密码是【PASS3word】. 这部分内容在 RSS 中没有被加密，在<a href="../../zh/non-math/memos/index.xml">“备忘分区”的 RSS</a> 中可以找到加密的内容.</p><div role="note" class="notation_color"><p>由于那个 python 的工具在 python 升级之后还要重新设置 venv 什么的，我嫌麻烦，于是找到类似的用 go 语言写的<a href="https://github.com/Izumiko/hugo-encrypt" target="_blank" rel="noreferrer noopener">加密工具<b><sub>⧉</sub></b></a>. 原理都是一样的，但这个工具的好处是：编译成二进制文件，随时都能使用；不需要那个奇怪的 <code>&lt;!-- more --&gt;</code> 写摘要了；提示文字可以通过 i18n 变量写成各种语言了；有了默认密码，我暂时设置为了“qwertyu”.</p><p>最后两项功能在<a href="../../en/62772/">英文页面</a>进行测试.</p></div><hugo-encrypt><div id="hugo-encrypt-encryption-notice"><p>以下内容被密码保护.</p><noscript><span id=hugo-encrypt-enable-js>Javascript needs to be enabled to decrypt content</span></noscript><div class="hugo-encrypt-form"><input class="hugo-encrypt-input" id="hugo-encrypt-password" placeholder="请输入密码."/>
<input class="hugo-encrypt-button" type="button" value="提交" id="button" onclick="hugoDecrypt(document.getElementById(&#34;hugo-encrypt-password&#34;).value,&#34;input&#34;)"/><div id="hugo-encrypt-input-response"></div></div></div><cipher-text style="display:none;">0d0697c15f856851-725a6c94c1e29cf49d076e80-fa7838102720722214f5910dfea212ece85daeafab6274be51cfdd379d574440117d1cb36729d85280e916abf72019125c4b16e0ea3b7cb5d081d0c2fef34f246df36cb826633af643e9cba8e5d25f1bafee2732574916682ffa33a760e01414d3cfaa5823cb99e326c600fe33c411d9b88cabf2593dc082b9c49a284c878cfda4bcc0e538c00ccabe8df20c9a4fe1f0d454a8b6d8df45b122926c222012ae57decc6819f5b9d2ff12052b8112514fca034395473c095c33c6d94ffac284b8c0098da6e51e877bfedc392ff5d5fea27f7778f51c70662027ef429ecce25a9765ea2e274ae92b9cb21ed791e4a66e9adaefaeed011b1414037dd48a38b09842e2cc1f92f2ae7ae9fc07b6b5923b5dd6f77ca80ef91d0f318b79b97364d89c9d407674ad329080105ebec973861b8fcc9a8835e05c48c2b02aab64ddb20bfae0b94481749813f99d64c15f377967f44b73fc6355ad1ea62f82181165659f2bff88ab51f012f1cfe62fe4aef6d3c58a118fc350fb3dd59be6abad8bce2b387268d7d901faeb695dd418a79d24f2460ed252aa63355dc322a18e893c19358d959a45b9ba5773aab384971e18cc5fc57ac874cf3dc6cc984734b8c45281cdc710de373eb93019c78d7285845d1c8f4cccd1df67f5f0c14babc5b898dd25ff0b27c55380e6c3e5b199b24a8f6d3773ddcf16fda6f19b97182c0a87572097ed56481617f57b8b81c6645fc40092c92edae62010f3ef73886156b106fd98828b4edf1db2eee5b743eb73b21eb94a0f57063318f118cbd205967505bb9b1ddba74e394475caedf269d0b53abed487a12be4a23293eb584c5b413a8f0cb2d251b18de9f8341dcb3e9220bbca71261c1f7b831c3926004e5f42c4043d4f09467204aa06e6a6043941af14172d7da6e37b36b2574194a84de41197d43e11a20ed33ff3b874c5c49818ac292c8236640dbbfd7c2a5aa0ab3bd9ea3b53fa6686571887a1f984ebdc4be4adba63a90241b969d1f6096282d4681a1a8519c24305a4f06ccfaeef08c90021543793e8c533dfe14cf4730da2680570b0868db8d9242c5d26586cb7bf1711a0aae3d3fe09a4664f80fc698bca05bd1c03085e2e79edb1ede6bc4bb9eb0ef230647f1972804c187fdbc9940d886309d0d9352f65995e4bd2362007ebf734ec8a7454a0acce87f19da4dd0864572f3d8be6317e52800dd6e8308ea4d889b3525e13c1dfc537211dfdfadbe3be4d4b65f3eea1bc1c9e2c64365d2e6e6f5bd3179375afbfc35095e1e0ceaed8fe8a363ddf0fc0b2e82b2ec49f1a7800978a2a47a15076633c7bf37b13a0128531026869169abe9d10643aaeee02d06135a1f691d12b5d265601e514371e9e304c8072d861efb3214aafd0c5da4519cd604bc4a8907a6a4ff17b678db5390fba0103c7ed6afc14bdbf9fdbd03abb7c31cc0618ae686fb5c973d9f9d79381ca80c01424bc3b4a6adad4e5c3f93e4f39e3ef3892b53f587d74718692aa337d61e8bd53cc75982e70ff1d0db100d63f2f82db4d28fb93c8088a99dc67e929998762aee5b5194f97d2b51a9d5528c6324601fecb0968089821d01cfaeafe3371e9a1325a4842b2982340b122a325682571a6edcd74697cf7abb72dc3e4551af847eef59d9ce92c8338662874048ce59a47a824b51f83bcdf8521b9b09142a84e1cd95722996f0841ce5524b95b2454c47ea3d49da28bb45b6b910f43f63fd57315bec711d6a62b831dfd1bd8f7b4bd175f820449f937eb021742a1131b26fc845286a816e08f644a9c496fd8b173a987212a97ae0176764e1f5e029ebede2daa5d8d237993215820c792ad25318c3e0b23c58eec491d74c52b1bc59905446ee708b255b24f9465ef7d737589aaece7dcc371e36ce52eeed13777b69ab66025277a41ca64802e0cc8597a71e388e8c9e38cfe272ebca2e4a31e96ff779e1d2f01278246c1452adc45c8f44605bb6357ecb40189b98cdfbfb2f51192c148cc128ec3dd47514b69a2dc4c9fe2a1e0fa6726e77242b48953540506d9b74c714726210cd12ee1b56a0b447e65a084803f5f41f9fb83b647b32f67576c63101078310e3f7f4998179e56ffb265eedb13c7505699f5e4e5462b4242ace75bec648946b4b400540005015b0fa1e6b95ba4f286a5897f5979580a47f3b085255ae5716b15615ec057e1b39679a909c1ab9d54e04e</cipher-text><style type="text/css">div#hugo-encrypt-sha1sum{display:none}</style><script>const storageKey=location.pathname+"password",userStorage=window.sessionStorage;function str2buf(e){return new TextEncoder("utf-8").encode(e)}function buf2str(e){return new TextDecoder("utf-8").decode(e)}function hex2buf(e){return new Uint8Array(e.match(/.{2}/g).map(e=>parseInt(e,16)))}function deriveKey(t,e){return e=e||crypto.getRandomValues(new Uint8Array(8)),crypto.subtle.importKey("raw",str2buf(t),"PBKDF2",!1,["deriveKey"]).then(t=>crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e3,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])).then(t=>[t,e])}function decrypt(e,t){const[n,s,o]=t.split("-").map(hex2buf);return deriveKey(e,n).then(([e])=>crypto.subtle.decrypt({name:"AES-GCM",iv:s},e,o)).then(e=>buf2str(new Uint8Array(e)))}async function digestMessage(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-1",t),s=Array.from(new Uint8Array(n)),o=s.map(e=>e.toString(16).padStart(2,"0")).join('');return o}const hugoDecrypt=function(e,t){for(const n of ciphers)decrypt(e,n.innerText).then(function(t){digestMessage(t.replace(/\r?\n?[^\r\n]*$/,"")).then(function(s){t.includes(s)&&(document.getElementById("hugo-encrypt-encryption-notice").remove(),n.outerHTML=t,userStorage.setItem(storageKey,e),document.getElementById("hugo-encrypt-sha1sum").innerHTML="Success: "+s,console.log("Decryption successful. Storing password in sessionStorage."))})}).catch(function(e){t==="input"?(document.getElementById("hugo-encrypt-input-response").innerHTML="密码错误！",console.log("密码错误！",e)):t==="storage"&&(userStorage.removeItem(location.pathname+"password"),console.log("Password changed. Clearing userStorage.",e))})}</script><script>window.onload=()=>{ciphers=Array.from(document.querySelectorAll("cipher-text")),userStorage.getItem(storageKey)&&(console.log("Found storageKey in userStorage. Attemtping decryption"),hugoDecrypt(userStorage.getItem(storageKey),"storage"))}</script></hugo-encrypt><h2 id="未被加密的标题">未被加密的标题
<a href="#%e6%9c%aa%e8%a2%ab%e5%8a%a0%e5%af%86%e7%9a%84%e6%a0%87%e9%a2%98"><small>¶</small></a></h2><p>在解密前这里的序号是1.1，解密后这里的序号是3.4.</p><h1 id="未被加密的一级标题">未被加密的一级标题
<a href="#%e6%9c%aa%e8%a2%ab%e5%8a%a0%e5%af%86%e7%9a%84%e4%b8%80%e7%ba%a7%e6%a0%87%e9%a2%98"><small>¶</small></a></h1><p>在解密前这里的序号是2，解密后这里的序号是4.</p><h2 id="未解决的问题">未解决的问题
<a href="#%e6%9c%aa%e8%a7%a3%e5%86%b3%e7%9a%84%e9%97%ae%e9%a2%98"><small>¶</small></a></h2><ol><li>目录会出现问题. 可能是 css 标签被改了的原因，具体没有仔细看，也不着急解决这个问题.</li><li>本地测试时把加密内容直接隐藏了，以至于只能先把文章写完再进行加密操作. 有个解决思路是用 <code>{{ if not .Site.IsServer }} {{ end }}</code> 在 <code>layouts/shortcodes/hugo-encryptor.html</code> 里做一下限制，不过试了一下不太会写，留待以后愿意解决再解决吧.</li><li><del>那个 <code>&lt;!-- more --&gt;</code> 的标签导致它上面的内容成为了 summary，而 front matter 里的 summary 不再起作用. 这倒不是什么大问题.</del></li><li>如果有两段加密内容的话，页面里有些 js 可能会重复，可以考虑精简精简. 还有就是“密码错误”的弹出位置可能不对，输入第二个密码却弹在第一个.（见英文页面）</li><li>阅读并理解代码，确定它的可靠性.（做那个 sha 之类的.）确定它没有从网络上获取什么 js.</li><li>弄得好看一点？</li></ol><p></p><p></p><p></p><p></p></article></div><div class="right_comments"><script src="https://utteranc.es/client.js" repo="zerovip/bcsu" issue-term="pathname" theme="github-light" crossorigin="anonymous" async=""></script></div></div><aside class="toc" id="toc"><button class="toc_title">目录</button><div class="toc_content"><nav id="TableOfContents"><ul><li><a href="#介绍">介绍</a><ul><li><a href="#未被加密的标题">未被加密的标题</a></li></ul></li><li><a href="#未被加密的一级标题">未被加密的一级标题</a><ul><li><a href="#未解决的问题">未解决的问题</a></li></ul></li></ul></nav></div></aside></div><script src="../../js/main.min.320be488d7313796cab3e8d6445bfce6f4e1740c6cbe4d20e8b19d3e82a9a532.js"></script></body></html>