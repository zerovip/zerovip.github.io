<!DOCTYPE html>
<html class="theme-container" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=divice-width,initial-scale=1" name="viewport"/>
<meta content="Hugo 0.88.1" name="generator"/>
<title>
静态博客文章加密工具测试
| 赤赤的象牙塔
</title>
<link href="../../css/base.min.7a1b5c1c1d7e43ac09f0cd1df239e034cbdf5fa7439794fb7b5fe1225963173c.css" rel="stylesheet" type="text/css"/>
<link href="../../css/small.min.f9c67371e05b88a9468d51903bbe4d52be301b7e498d3f1dc7fbff95f35f2929.css" media="screen and (max-width: 1200px)" rel="stylesheet" type="text/css"/>
<link href="../../css/normal.min.b2c3863a3378b939831ae6c21fa348234f23ec0c6879be2c4a92cf6be2a9fa56.css" media="screen and (min-width: 1201px)" rel="stylesheet" type="text/css"/>
<script src="../../js/ctheme.min.2b9744ea6df95f636aae562954ce13add68a9c7b99203c9ac1aa4671b6238958.js" type="text/javascript"></script>
<link href="../../css/syntax.min.ed5b37c3a50997d5ccd8b81bf0d00a7ac1f92c82985623c2dbf0cb422596726a.css" rel="stylesheet" type="text/css"/>
<script type="application/javascript">var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-143006759-1','auto'),ga('send','pageview'))</script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script async="" data-goatcounter="https://zerovip.goatcounter.com/count" src="//gc.zgo.at/count.js"></script>
</head>
<body>
<nav class="bar_for_phone">
<div class="bar_left_button">
<div class="left_button_for_bar" onclick="ChangeClassLeft()">
<div class="bar1"></div>
<div class="bar2"></div>
<div class="bar3"></div>
</div>
</div>
<div class="bar_title">
<a href="../../zh/">赤赤的象牙塔</a>
</div>
<div class="bar_right_button">
<button class="toc_title_for_bar" onclick="ChangeClassTOC()">目录</button>
</div>
</nav>
<div class="body_for_pc">
<aside class="left" id="left">
<div class="left_non-footer">
<div class="left_non-footer_option">
<div class="left_non-footer_option_theme-switch" role="checkbox">
<label class="switch">
<input class="theme-switcher" onchange="themeSwitch()" type="checkbox"/>
<span class="slider round"></span>
</label>
</div>
<ul class="left_non-footer_option_language" role="radiogroup">
<li aria-checked="true" class="left_non-footer_option_active" role="radio">
简体中文 ⦿
</li>
<li aria-checked="disabled" class="left_non-footer_option_non-active" role="radio">
English ⨂
</li>
<li aria-checked="disabled" class="left_non-footer_option_non-active" role="radio">
Français ⨂
</li>
</ul>
<div class="left_non-footer_option_rss" role="button">
<li class="left_non-footer_option_non-active">
RSS 订阅 ⊠
</li>
</div>
</div>
<header class="left_non-footer_head">
<div class="left_non-footer_head_title">
<a href="../../zh/">
赤赤的象牙塔
</a>
</div>
<div class="left_non-footer_head_subtitle">(●’◡’●)ﾉ</div>
</header>
<nav class="left_non-footer_main">
<div class="h1">
<a href="../../zh/math/">数学</a>
</div>
<div class="h2">
<a href="../../zh/math/notes/">数学笔记 </a>
</div>
<div class="h2">
<a href="../../zh/math/stories/">数学科普 </a>
</div>
<div class="h1 active">
<a href="../../zh/non-math/">非数学</a>
</div>
<div class="h2">
<a href="../../zh/non-math/journal/">日志 </a>
</div>
<div class="h2">
<a href="../../zh/non-math/literature/">写作 </a>
</div>
<div class="h2 active">
<a href="../../zh/non-math/memos/">备忘 </a>
</div>
<div class="h1">
<a href="../../zh/record/">记录</a>
</div>
<div class="h2">
<a href="../../zh/record/book/">读过的书 </a>
</div>
<div class="h2">
<a href="../../zh/record/film/">看过的电影 </a>
</div>
<div class="h1">
<a href="../../zh/about/">关于</a>
</div>
<div class="h2">
<a href="../../zh/about/me/">关于我 </a>
</div>
<div class="h2">
<a href="../../zh/about/site/">关于本站 </a>
</div>
</nav>
</div>
<footer class="left_footer">
<div class="copyright">©2019-2021 版权所有.</div>
</footer>
</aside>
<div class="right" onclick="HideBothSide()">
<header class="right_head">
<div class="right_head_title">
静态博客文章加密工具测试
</div>
<div class="right_head_des">
<time>2019年12月23日</time> - 664 字
</div>
</header>
<div class="right_main">
<article class="right_main_article">
<p>一次测试.（这里是 summary 的内容.）</p>
<h1 id="介绍">
介绍
<a href="#%e4%bb%8b%e7%bb%8d"><small>¶</small></a>
</h1>
<p><a href="https://github.com/Li4n0/hugo_encryptor" rel="noreferrer noopener" target="_blank">Hugo encryptor<b><sub>⧉</sub></b></a> 是一款我偶然发现的可以给静态博客文章进行加密的小工具，配置使用很简单，可惜的是不能在本地测试.</p>
<p>不过它足够简单，一经测试成功可以投入使用便不再需要反复测试，因此这篇博文是专门用来测试的.</p>
<p>下面加密内容的密码是【PASS3word】. 这部分内容在 RSS 中没有被加密，在<a href="../../zh/non-math/memos/index.xml">“备忘分区”的 RSS</a> 中可以找到加密的内容.</p>
<div class="hugo-encryptor-container">
<div class="hugo-encryptor-prompt">
<p>文章的部分内容被密码保护：</p>
</div>
<div class="hugo-encryptor-form">
<input class="hugo-encryptor-input" placeholder="请输入密码"/>
<input class="hugo-encryptor-button" onclick="_click_handler(this)" type="button" value="点击验证"/>
</div>
<div class="hugo-encryptor-cipher-text" style="display:none">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</div>
</div>
<h2 id="未被加密的标题">
未被加密的标题
<a href="#%e6%9c%aa%e8%a2%ab%e5%8a%a0%e5%af%86%e7%9a%84%e6%a0%87%e9%a2%98"><small>¶</small></a>
</h2>
<p>在解密前这里的序号是1.1，解密后这里的序号是3.4.</p>
<h1 id="未被加密的一级标题">
未被加密的一级标题
<a href="#%e6%9c%aa%e8%a2%ab%e5%8a%a0%e5%af%86%e7%9a%84%e4%b8%80%e7%ba%a7%e6%a0%87%e9%a2%98"><small>¶</small></a>
</h1>
<p>在解密前这里的序号是2，解密后这里的序号是4.</p>
<h2 id="未解决的问题">
未解决的问题
<a href="#%e6%9c%aa%e8%a7%a3%e5%86%b3%e7%9a%84%e9%97%ae%e9%a2%98"><small>¶</small></a>
</h2>
<ol>
<li>目录会出现问题. 可能是 css 标签被改了的原因，具体没有仔细看，也不着急解决这个问题.</li>
<li>本地测试时把加密内容直接隐藏了，以至于只能先把文章写完再进行加密操作. 有个解决思路是用 <code>{{ if not .Site.IsServer }} {{ end }}</code> 在 <code>layouts/shortcodes/hugo-encryptor.html</code> 里做一下限制，不过试了一下不太会写，留待以后愿意解决再解决吧.</li>
<li>那个 <code>&lt;!--more--&gt;</code> 的标签导致它上面的内容成为了 summary，而 front matter 里的 summary 不再起作用. 这倒不是什么大问题.</li>
</ol>
<p></p><p></p><p></p><p></p>
</article>
</div>
<div class="right_comments">
<script async="" crossorigin="anonymous" issue-term="pathname" repo="zerovip/bcsu" src="https://utteranc.es/client.js" theme="github-light"></script>
</div>
</div>
<aside class="toc" id="toc">
<button class="toc_title">目录</button>
<div class="toc_content">
<nav id="TableOfContents">
<ul>
<li><a href="#介绍">介绍</a>
<ul>
<li><a href="#未被加密的标题">未被加密的标题</a></li>
</ul>
</li>
<li><a href="#未被加密的一级标题">未被加密的一级标题</a>
<ul>
<li><a href="#未解决的问题">未解决的问题</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</div>
<script src="../../js/main.min.09f704e0a8070b3bf9bceadff3f53e38344d199eb99f6a52643c082c23945ce5.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script><script>
const _do_decrypt = function(encrypted, password) {
  let key = CryptoJS.enc.Utf8.parse(password);
  let iv = CryptoJS.enc.Utf8.parse(password.substr(16));

  let decrypted_data = CryptoJS.AES.decrypt(encrypted, key, {
    iv: iv,
    mode: CryptoJS.mode.CBC,
    padding: CryptoJS.pad.Pkcs7
  });
  return decrypted_data.toString(CryptoJS.enc.Utf8);
};

const _click_handler = function(element) {
  let parent = element.parentNode.parentNode;
  let encrypted = parent.querySelector(
    ".hugo-encryptor-cipher-text").innerText;
  let password = parent.querySelector(
    ".hugo-encryptor-input").value;
  password = CryptoJS.MD5(password).toString();

  let index = -1;
  let elements = document.querySelectorAll(
    ".hugo-encryptor-container");
  for (index = 0; index < elements.length; ++index) {
    if (elements[index].isSameNode(parent)) {
      break;
    }
  }

  let decrypted = "";
  try {
    decrypted = _do_decrypt(encrypted, password);
  } catch (err) {
    console.error(err);
    alert("Failed to decrypt.");
    return;
  }

  if (!decrypted.includes("--- DON'T MODIFY THIS LINE ---")) {
    alert("Incorrect password.");
    return;
  }

  let storage = localStorage;

  let key = location.pathname + ".password." + index;
  storage.setItem(key, password);
  parent.innerHTML = decrypted;
}

window.onload = () => {
  let index = -1;
  let elements = document.querySelectorAll(
    ".hugo-encryptor-container");

  while (1) {
    ++index;

    let key = location.pathname + ".password." + index;
    let password = localStorage.getItem(key);

    if (!password) {
      break;

    } else {
      console.log("Found password for part " + index);

      let parent = elements[index];
      let encrypted = parent.querySelector(".hugo-encryptor-cipher-text").innerText;
      let decrypted = _do_decrypt(encrypted, password);
      elements[index].innerHTML = decrypted;
    }
  }
};</script></body>
</html>