<!DOCTYPE html><html lang="en" class="theme-container"><head><meta charset="utf-8"/><meta name="viewport" content="width=divice-width,initial-scale=1"/><meta name="generator" content="Hugo 0.112.3"/><title>Fix the White Flash on Page Load When Using a Dark Mode on a Static Site - Build a Theme
| Zero&#39;s Ivory Tower</title><link rel="stylesheet" type="text/css" href="../../css/base.min.77b5736a81ec178b46cb581d1318f5aee784504170c67bf68d9e3c729b7fff42.css"/><link rel="stylesheet" media="screen and (max-width: 1200px)" type="text/css" href="../../css/small.min.3b39abcf5074cbb0bd712da27c43d1c5f11a85f597da9f07a0d600e53eec7d24.css"/><link rel="stylesheet" media="screen and (min-width: 1201px)" type="text/css" href="../../css/normal.min.ac1ee5c0e20afb15107d14583eece7d76c7fb36009c07be3f3447c299209ca53.css"/><link rel="stylesheet" type="text/css" href="../../css/syntax.min.ed5b37c3a50997d5ccd8b81bf0d00a7ac1f92c82985623c2dbf0cb422596726a.css"/><script src="../../js/ctheme.min.23d42d00e692299bcf2b5832c28a8a1582346c7c45d8bc4f70280fcdbf146872.js"></script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6CF2JBMYH3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6CF2JBMYH3",{anonymize_ip:!1})}</script><script data-goatcounter="https://zerovip.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script></head><body><nav class="bar_for_phone"><div class="bar_left_button"><div class="left_button_for_bar" onclick="ChangeClassLeft()"><div class="bar1"></div><div class="bar2"></div><div class="bar3"></div></div></div><div class="bar_search-box" onclick="startSearch(&#34;right&#34;)"><div class="magnifying-glass"></div></div><div class="bar_title"><a href="../../en/">Zero&#39;s Ivory Tower</a></div><div class="bar_right_button"><button class="toc_title_for_bar" onclick="ChangeClassTOC()">Contents</button></div></nav><div class="body_for_pc"><aside class="left" id="left"><div class="left_non-footer" id="left_non-footer"><div class="left_non-footer_option"><div class="left_non-footer_option_search-icon" onclick="startSearch(&#34;left_non-footer&#34;)"><div class="magnifying-glass"></div></div><div role="checkbox" aria-checked="true" class="left_non-footer_option_theme-switch"><label class="switch"><input type="checkbox" class="theme-switcher" onchange="themeSwitch()"/>
<span class="slider round"></span></label></div><ul role="listbox" class="left_non-footer_option_language"><li role="option" aria-selected="false" class="left_non-footer_option_non-active"><a href="../../zh/01901/">简体中文 ○</a></li><li role="option" aria-selected="true" class="left_non-footer_option_active">English ⦿</li><li role="option" class="left_non-footer_option_non-active">Français ⨂</li></ul><div class="left_non-footer_option_rss"><div class="left_non-footer_option_non-active">RSS feed ⊠</div></div></div><header class="left_non-footer_head"><div class="left_non-footer_head_title"><a href="../../en/">Zero&#39;s Ivory Tower</a></div><div class="left_non-footer_head_subtitle">(●’◡’●)ﾉ</div></header><nav class="left_non-footer_main"><div class="h1"><a href="../../en/math/">MATHEMATICS</a></div><div class="h2"><a href="../../en/math/notes/">Math Noes</a></div><div class="h2"><a href="../../en/math/stories/">Math Stories</a></div><div data-pagefind-filter="1st-section" class="h1 active"><a href="../../en/non-math/">NON-MATHMATICS</a></div><div class="h2"><a href="../../en/non-math/journal/">Journal</a></div><div class="h2"><a href="../../en/non-math/literature/">Literature</a></div><div data-pagefind-filter="2nd-section" class="h2 active"><a href="../../en/non-math/memos/">Memos</a></div><div class="h1"><a href="../../en/record/">RECORD</a></div><div class="h2"><a href="../../en/record/book/">Books Read</a></div><div class="h2"><a href="../../en/record/film/">Films Watched</a></div><div class="h1"><a href="../../en/about/">ABOUT</a></div><div class="h2"><a href="../../en/about/me/">About Me</a></div><div class="h2"><a href="../../en/about/site/">About The Site</a></div></nav></div><footer class="left_footer"><div class="copyright">©2019-2023 All Right Reserved.</div></footer></aside><div data-pagefind-body="" class="right" id="right" onclick="HideBothSide()"><header class="right_head"><div data-pagefind-meta="title" class="right_head_title">Fix the White Flash on Page Load When Using a Dark Mode on a Static Site - Build a Theme</div><div data-pagefind-ignore="" class="right_head_des"><span data-pagefind-meta="date">August 27, 2021</span> - 631 words</div></header><div class="right_main"><article class="right_main_article"><h1 id="the-problem">The problem
<a href="#the-problem"><small data-pagefind-ignore="">¶</small></a></h1><p>This Hugo theme I wrote have had a problem. It defaults to the light mode, but if you switch to the dark mode<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, then when loading a new page it will first render the light mode and then automatically switch to the dark, looks like it flashes white a little bit. I thought all the static sites have to face this problem, until one day I found some healthy themes, for instance, <a href="https://adityatelange.github.io/hugo-PaperMod/" target="_blank" rel="noreferrer noopener">PaperMod<b><sub data-pagefind-ignore="">⧉</sub></b></a>. So, there must be a way to solve this.</p><p>I searched this on the internet. There is an article <a href="https://zwbetz.com/fix-the-white-flash-on-page-load-when-using-a-dark-theme-on-a-static-site/" target="_blank" rel="noreferrer noopener">Fix the White Flash on Page Load When Using a Dark Theme on a Static Site<b><sub data-pagefind-ignore="">⧉</sub></b></a> by the maintainer of <a href="https://github.com/zwbetz-gh/cupper-hugo-theme" target="_blank" rel="noreferrer noopener">theme Cupper<b><sub data-pagefind-ignore="">⧉</sub></b></a>. I tried their solution. In Chrome, it indeed works; but in Firefox it doesn’t. Firefox will render <code>visibility: hidden; opacity: 0;</code> to a whole blank page, and only after <code>DOMContentLoaded</code> happens <code>showContent()</code> function will show the content. Means: the page still flashes. Before it flashes the <strong>light mode</strong>, now it flashes the <strong>blank page</strong>. Just as bad as before.</p><p>I think the difference between Firefox and Chrome is because the developers of Chrome used magic, they tried their best to bring Chrome users a better experience. And this covers up the real problem for the Hugo theme developers who use Chrome.</p><h1 id="find-the-cause">Find the cause
<a href="#find-the-cause"><small data-pagefind-ignore="">¶</small></a></h1><p>The main idea is still to understand the process of how the browser render a page. Simply put:</p><ul><li>You request for a page;</li><li>The browser download the entire HTML and save as DOM, then parse and render the page from top to bottom;</li><li>Stop parsing when encountering an external CSS or JavaScript file. Download it and then continue;</li><li>When encountering <code>&lt;style&gt;&lt;/style&gt;</code> or just loaded external styles, store them as CSSOM and re-render the influential part;</li><li>When encountering <code>&lt;script&gt;&lt;/script&gt;</code> or just loaded external scripts, stop parsing and run the scripts. Continue parsing and rendering after finish running them;</li><li>So on and so on until all the works are done.</li></ul><p>The cause to the white flash problem is that I put the JavaScript for theme’s mode switching at the end of <code>&lt;body&gt;</code>, like this:</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- lots of stuff…… --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;changeTheme.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h1 id="the-solution">The solution
<a href="#the-solution"><small data-pagefind-ignore="">¶</small></a></h1><p>The solution to this problem is quite simple, with two points:</p><ul><li><ol><li>Put the script for theme’s mode switching into <code>&lt;head&gt;</code>, in order to determine the theme currently selected by the user before rendering the body;</li></ol></li><li><ol start="2"><li>Upgrade the container for the theme to the entire <code>&lt;html&gt;</code>, i.e., from</li></ol></li></ul><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">body</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;theme-container&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>to</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;theme-container&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>This is because <code>&lt;body&gt;</code> has not been rendered at this time, and the only object that can be manipulated by the script in <code>&lt;head&gt;</code> is <code>&lt;html&gt;</code>.</p><hr/><p>Now the problem is completely solved, the complete code is as follows:</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;theme-container&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- lots of stuff…… --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">themeContainer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;.theme-container&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">theme</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&#34;theme&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">theme</span> <span class="o">==</span> <span class="s2">&#34;dark&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">themeContainer</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&#34;dark&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">theme</span> <span class="o">==</span> <span class="s2">&#34;light&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">themeContainer</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&#34;dark&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- lots of stuff…… --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;others.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></tbody></table></div></div><div class="footnotes" role="doc-endnotes"><hr/><ol><li id="fn:1"><p>The approach to dark mode in this theme is CSS variable, see <a href="https://dev.to/lampewebdev/css-quickies-css-variables-or-how-you-create-a-white-dark-theme-easily-1i0i" target="_blank" rel="noreferrer noopener">this tutorial<b><sub data-pagefind-ignore="">⧉</sub></b></a> for reference. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">↩︎</a></p></li></ol></div><p></p><p></p><p></p><p></p><p></p><p></p><h1 data-pagefind-ignore="">See also</h1><ol data-pagefind-ignore=""><li>No.1: Fix the White Flash on Page Load When Using a Dark Mode on a Static Site - Build a Theme (This one!)</li><li>No.2: <a href="../../en/15738/">Make Hugo Invert Color for Images when Using a Dark Mode - Build a Theme</a></li></ol><p></p><p></p><p></p><p></p></article></div><div data-pagefind-ignore="" class="right_comments"><script src="https://utteranc.es/client.js" repo="zerovip/bcsu" issue-term="pathname" theme="github-light" crossorigin="anonymous" async=""></script></div></div><aside data-pagefind-ignore="" class="toc" id="toc"><button class="toc_title">Contents</button><div class="toc_content"><nav id="TableOfContents"><ul><li><a href="#the-problem">The problem</a></li><li><a href="#find-the-cause">Find the cause</a></li><li><a href="#the-solution">The solution</a></li></ul></nav></div></aside></div><template id="search-zone-template"><div id="search-zone"><div class="search_bar"><input type="search" id="search-input-box" class="search_bar_search-box" placeholder="Search…" autocomplete="off"/><div class="search_bar_close-sign" onclick="closeSearch(this)"><div class="close-sign"></div></div></div><div class="search_results"></div></div></template><template id="search-result"><div class="search_results_item"><div class="search_results_item_title"></div><div class="search_results_item_content"></div><div class="search_results_item_tags"><div class="search_results_item_tags_date"></div><div class="search_results_item_tags_sections"></div></div></div></template><script src="../../js/main.07644855453ea3563fc25b36d91f32b4aa952cd60ebafb6fad77cf9c74baea47.js"></script></body></html>